ISP_block_data %$% table(vomiting, group) %>% fisher.test()
ISP_block_data %$% table(pruritis, group) %>% fisher.test()
# As the frequency of specific ADRs is very low, We could create a column of wether there is any ADR or not
ISP_block_data %>% select(nausea:pruritis, Any_ADR, group) %>% tbl_summary(by = group,
label = list(
nausea ~ "Nausea",
vomiting ~ "Vomiting",
pruritis ~ "Pruritis",
Any_ADR ~ "Any ADRs")) %>%
add_p() %>% as_flex_table()
# As the frequency of specific ADRs is very low, We could create a column of wether there is any ADR or not
ISP_block_data %>% mutate(Any_ADR =  Any_ADR = factor(as.integer(nausea == 1 | vomiting == 1 | pruritis == 1),
# As the frequency of specific ADRs is very low, We could create a column of wether there is any ADR or not
ISP_block_data %>% mutate(Any_ADR = factor(as.integer(nausea == 1 | vomiting == 1 | pruritis == 1),
levels = c(0, 1),
labels = c("No", "Yes")))
ISP_block_data %>% select(nausea:pruritis, Any_ADR, group) %>% tbl_summary(by = group,
label = list(
nausea ~ "Nausea",
vomiting ~ "Vomiting",
pruritis ~ "Pruritis",
Any_ADR ~ "Any ADRs")) %>%
add_p() %>% as_flex_table()
# As the frequency of specific ADRs is very low, We could create a column of wether there is any ADR or not
ISP_block_data <- ISP_block_data %>% mutate(Any_ADR = factor(as.integer(nausea == 1 | vomiting == 1 | pruritis == 1),
levels = c(0, 1),
labels = c("No", "Yes")))
ISP_block_data %>% select(nausea:pruritis, Any_ADR, group) %>% tbl_summary(by = group,
label = list(
nausea ~ "Nausea",
vomiting ~ "Vomiting",
pruritis ~ "Pruritis",
Any_ADR ~ "Any ADRs")) %>%
add_p() %>% as_flex_table()
# Making a summary table for comparison of numbers of ADRs occurred between the two groups
ISP_block_data %>% select(nausea:pruritis, Any_ADR, group) %>% tbl_summary(by = group,
label = list(
nausea ~ "Nausea",
vomiting ~ "Vomiting",
pruritis ~ "Pruritis",
Any_ADR ~ "Any ADRs"),
type = list(
nausea ~ "event",
vomiting ~ "event",
pruritis ~ "event",
Any_ADR ~ "event"
)) %>%
add_p() %>% as_flex_table()
# Making a summary table for comparison of numbers of ADRs occurred between the two groups
ISP_block_data %>% select(nausea:pruritis, Any_ADR, group) %>% tbl_summary(by = group,
label = list(
nausea ~ "Nausea",
vomiting ~ "Vomiting",
pruritis ~ "Pruritis",
Any_ADR ~ "Any ADRs"),
type = list(
nausea ~ "dichotomous",
vomiting ~ "dichotomous",
pruritis ~ "dichotomous",
Any_ADR ~ "dichotomous"
)) %>%
add_p() %>% as_flex_table()
# Making a summary table for comparison of numbers of ADRs occurred between the two groups
ISP_block_data %>% select(nausea:pruritis, Any_ADR, group) %>%
tbl_summary(by = group, label = list(
nausea ~ "Nausea", vomiting ~ "Vomiting", pruritis ~ "Pruritis", Any_ADR ~ "Any ADRs"),
type = list( nausea ~ "dichotomous", vomiting ~ "dichotomous", pruritis ~ "dichotomous", Any_ADR ~ "dichotomous"),
value = list(nausea ~ 1, vomiting ~ 1, pruritis ~ 1, Any_ADR ~ "Yes")) %>%
add_p() %>% as_flex_table()
ISP_block_data %>% select(group, contains("VAS"))
ISP_block_data %>% select(group, contains("VAS")) %>% tbl_summary(by = group) %>% add_p()
ISP_block_data %>% select(group, contains("VAS"))
ISP_block_data %>% select(contains("VAS")) %>% colnames(
)
ISP_block_data %>% select(group, contains("VAS")) %>% mutate(across(contains("VAS") ~ as.numeric(.x))) %>%
tbl_summary(by = group) %>% add_p()
ISP_block_data %>% select(group, contains("VAS")) %>% mutate(across(contains("VAS") ~ as.numeric(.x))) %>%
tbl_summary(by = group) %>% add_p()
ISP_block_data %>% select(group, contains("VAS")) %>% mutate(across(contains("VAS") ~ as.numeric(.x))) %>%
tbl_summary(by = group) %>% add_p()
ISP_block_data %>% select(group, contains("VAS")) %>% mutate(across(contains("VAS") ~ as.numeric(.x))) %>%
tbl_summary(by = group) %>% add_p()
ISP_block_data %>% select(group, contains("VAS")) %>% mutate(across(contains("VAS"), ~ as.numeric(.x))) %>%
tbl_summary(by = group) %>% add_p()
ISP_block_data %>% select(group, contains("VAS")) %>% mutate(across(contains("VAS"), ~ as.numeric(.x))) %>%
tbl_summary(by = group) %>% add_p()
ISP_block_data %>% select(group, contains("VAS")) %>%
tbl_summary(by = group,
type = list(contains("VAS") ~ "continuous")) %>% add_p()
ISP_block_data %>% select(group, contains("VAS")) %>%
tbl_summary(by = group,
type = list(contains("VAS") ~ "continuous")) %>% add_p() %>% add_q(method = "bonferroni")
ISP_block_data %>% select(group, contains("VAS")) %>%
tbl_summary(by = group,
type = list(contains("VAS") ~ "continuous")) %>% add_p() %>% add_q(method = "bonferroni") %>%
modify_column_hide(p.value)
ISP_block_data %>% select(group, contains("VAS")) %>%
tbl_summary(by = group,
type = list(contains("VAS") ~ "continuous")) %>% add_p() %>% add_q(method = "bonferroni") %>%
modify_column_hide(p.value) %>% as_flex_table()
ISP_block_data %>% select(group, contains("VAS")) %>%
tbl_summary(by = group,
type = list(contains("VAS") ~ "continuous")) %>% add_p() %>% add_q(method = "bonferroni") %>% as_flex_table()
ISP_block_data %>% sele
ISP_block_data %>% select(group, `patient satisification`) %>% tbl_summary(by = group) %>% add_p()
ISP_block_data %>% select(ID, contains("VAS"), -`Pre opr VAS score`, group) %>%
pivot_longer(cols = matches("VAS"), names_to = "Time", values_to = "VAS") %>%
mutate(Time = factor(Time, levels = c("30 min post opt VAS", "1 h post opt VAS", "2h post opt VAS", "4 h post opt VAS",
"6h post opt VAS", "8h post opt VAS", "12h post opt VAS", "18h post opt VAS",
"24h post opt VAS", "36h post opt VAS", "48h post opt VAS"),
labels = c("30 min", "1h", "2h", "4h", "6h", "8h", "12h", "18h", "24h", "36h", "48h")))
VAS_Visual <- VAS_Summ %>% ggplot(aes(Time, Median, fill = group)) + geom_col(position = position_dodge(width = 0.5)) +
scale_fill_manual(values = c("#023E8A", "#00B4D8")) + theme_minimal()
# Adjusting the format of the table, making long format for VAS scores so we could plot the data
long_format <- ISP_block_data %>% select(ID, contains("VAS"), -`Pre opr VAS score`, group) %>%
pivot_longer(cols = matches("VAS"), names_to = "Time", values_to = "VAS") %>%
mutate(Time = factor(Time, levels = c("30 min post opt VAS", "1 h post opt VAS", "2h post opt VAS", "4 h post opt VAS",
"6h post opt VAS", "8h post opt VAS", "12h post opt VAS", "18h post opt VAS",
"24h post opt VAS", "36h post opt VAS", "48h post opt VAS"),
labels = c("30 min", "1h", "2h", "4h", "6h", "8h", "12h", "18h", "24h", "36h", "48h")))
VAS_Summ <- long_format %>% group_by(group, Time) %>% summarise(Median = median(VAS), IQR = IQR(VAS))
VAS_Visual <- VAS_Summ %>% ggplot(aes(Time, Median, fill = group)) + geom_col(position = position_dodge(width = 0.5)) +
scale_fill_manual(values = c("#023E8A", "#00B4D8")) + theme_minimal()
VAS_Visual
source("~/Documents/Research/Research Projects/Minwal M.Elsherif Practical Course/Inter-semispinal plane (ISP) block for postoperative analgesia /Data_Upload_Clean.R", echo = TRUE)
# Running the code for the cleaned data to analyze
source(file = "Data_Upload_Clean.R")
library(gtsummary)
library(broom)
library(magrittr)
library(epiR)
library(survival)
library(survminer)
library(finalfit)
library(flextable)
# KM curve
max(ISP_block_data$time_of_peth_post_opt_min))
# KM curve
max(ISP_block_data$time_of_peth_post_opt_min)
ISP_block_data %>% mutate(if(time_of_peth_post_opt_min == 0 )(480))
ISP_block_data %>% mutate(if(time_of_peth_post_opt_min == 0 ){480})
ISP_block_data %>% mutate(if(time_of_peth_post_opt_min == 0, 480)
ISP_block_data %>% mutate(time_of_peth_post_opt_min = ifelse(
time_of_peth_post_opt_min == 0, 480, time_of_peth_post_opt_min
))
source("~/Documents/Research/Research Projects/Minwal M.Elsherif Practical Course/Inter-semispinal plane (ISP) block for postoperative analgesia /Demographics_And_Analysis.R", echo = TRUE)
ISP_block_data %>% mutate(time_of_peth_post_opt_min = ifelse(
time_of_peth_post_opt_min == 0, 480, time_of_peth_post_opt_min
)) %>% pull()
ISP_block_data %>% mutate(time_of_peth_post_opt_min = ifelse(
time_of_peth_post_opt_min == 0, 480, time_of_peth_post_opt_min
)) %>% pull()
ISP_block_data %>% mutate(time_of_peth_post_opt_min = ifelse(
time_of_peth_post_opt_min == 0, 480, time_of_peth_post_opt_min
)) %>% pull(time_of_peth_post_opt_min)
ISP_block_data %>% Surv(time = time_of_peth_post_opt_min, `need of pethidine post operative`)
ISP_block_data %>% Surv(time = time_of_peth_post_opt_min, `need of pethidine post operative`, data = .)
ISP_block_data %>% Surv(time = time_of_peth_post_opt_min, `need of pethidine post operative`)
ISP_block_data %>% Surv(time = time_of_peth_post_opt_min, `need of pethidine post operative`)
Surv(time = ISP_block_data$time_of_peth_post_opt_min, ISP_block_data$`need of pethidine post operative`)
survival_object <- Surv(time = ISP_block_data$time_of_peth_post_opt_min, ISP_block_data$`need of pethidine post operative`)
survfit(survival_object ~ group, data = ISP_block_data)
surv_fit <- survfit(survival_object ~ group, data = ISP_block_data)
summary(surv_fit)
summary(surv_fit, times = 120)
ISP_block_data %>% surv_plot(survival_object, group, pval = T)
ISP_block_data %>% surv_plot(survival_object, group, pval = T)
surv_plot(survival_object, ISP_block_data$group, pval = T)
surv_plot(dependent = survival_object, explanatory = ISP_block_data$group, pval = T)
ISP_block_data %>% surv_plot(dependent = survival_object, explanatory = c("group"), pval = T)
# KM curve
class(ISP_block_data$`need of pethidine post operative`)
# KM curve
as.numeric(ISP_block_data$`need of pethidine post operative`)
# KM curve
ifelse(as.numeric(ISP_block_data$`need of pethidine post operative`) == 2, 1,0)
# KM curve
ISP_block_data %>% mutate(`need of pethidine post operative` = ifelse(as.numeric(ISP_block_data$`need of pethidine post operative`) == 2, 1,0)
)
# KM curve
ISP_block_data <- ISP_block_data %>% mutate(`need of pethidine post operative` = ifelse(as.numeric(ISP_block_data$`need of pethidine post operative`) == 2, 1,0)
)
max(ISP_block_data$time_of_peth_post_opt_min)
ISP_block_data <- ISP_block_data %>% mutate(time_of_peth_post_opt_min = ifelse(
time_of_peth_post_opt_min == 0, 480, time_of_peth_post_opt_min
))
survival_object <- Surv(time = ISP_block_data$time_of_peth_post_opt_min, ISP_block_data$`need of pethidine post operative`)
surv_fit <- survfit(survival_object ~ group, data = ISP_block_data)
surv_fit
summary(surv_fit, times = 120)
summary(surv_fit)
ISP_block_data %>% surv_plot(dependent = survival_object, explanatory = c("group"), pval = T)
ISP_block_data %>% surv_plot(dependent = "Surv(time_of_peth_post_opt_min, `need of pethidine post operative`)",
explanatory = "group", pval = T)
# KM curve
ISP_block_data <- ISP_block_data %>% mutate(`need of pethidine post operative` = ifelse(as.numeric(ISP_block_data$`need of pethidine post operative`) == 2, 1,0)
)
max(ISP_block_data$time_of_peth_post_opt_min)
ISP_block_data <- ISP_block_data %>% mutate(time_of_peth_post_opt_min = ifelse(
time_of_peth_post_opt_min == 0, 480, time_of_peth_post_opt_min
))
survival_object <- Surv(time = ISP_block_data$time_of_peth_post_opt_min, ISP_block_data$`need of pethidine post operative`)
surv_fit <- survfit(survival_object ~ group, data = ISP_block_data)
ISP_block_data %>% surv_plot(dependent = "Surv(time_of_peth_post_opt_min, `need of pethidine post operative`)",
explanatory = "group", pval = T)
# Reading the data from the excel file with skippinng first row as it contains unneded organization
ISP_block_data <- read_excel(path = "Project-1-data copy.xlsx", skip = 1)
# Renaming columns to names shorter, representative and more easy to deal with
ISP_block_data <- ISP_block_data %>% rename(time_of_peth_post_opt_min = `time of pethidine post operative (min)`,
first_dose_peth_post_opt_mg = `first dose of pethidine post operative (mg)`,
total_peth_post_opt_mg = `total of pethidine post operative (mg)`,
intra_opt_fentanyl_consump_mic = `intra oprative fentanyl consumption (mic)`)
# Removing extra spaces in front and back of the column values
ISP_block_data$group <- ISP_block_data$group %>% str_trim()
# Removing text present with values of columns that should only include numeric data
ISP_block_data$first_dose_peth_post_opt_mg <- ISP_block_data$first_dose_peth_post_opt_mg %>% str_remove("mg") %>% str_trim()
ISP_block_data$total_peth_post_opt_mg <- ISP_block_data$total_peth_post_opt_mg %>% str_remove("mg") %>% str_trim()
ISP_block_data$intra_opt_fentanyl_consump_mic <- ISP_block_data$intra_opt_fentanyl_consump_mic %>% str_remove("mic") %>% str_trim()
# Coding columns to be factors and setting up codes as needed
ISP_block_data$sex <- factor(ISP_block_data$sex) %>% fct_recode("Female" = "0", "Male" = "1")
ISP_block_data$group <- factor(ISP_block_data$group) %>% fct_recode(
"Control group" = "control group", "ISSP Block group" = "ISSP block"
)
# Removing extra spaces in front and back of the column values
ISP_block_data$group <- ISP_block_data$group %>% str_trim()
factor(ISP_block_data$`need of pethidine post operative`) %>% levels()
# Coding columns to be factors and setting up codes as needed
ISP_block_data$`need of pethidine post operative` <- factor(ISP_block_data$`need of pethidine post operative`)
ISP_block_data <- ISP_block_data %>% mutate(across("patient satisification", ~ fct_recode(as.factor(.x),
"satisfied" = "3",
"fair" = "2",
"dissatisfied" = "1")))
ISP_block_data$`surgeon satisification` <- ISP_block_data$`surgeon satisification` %>% factor() %>% fct_recode(
"very good" = "5",
"good" = "4",
"fair" = "3",
"not bad" = "2",
"dissatisfied" = "1"
)
ISP_block_data <- ISP_block_data %>% mutate(across(c("nausea", "vomiting", "pruritis", "others"), ~ factor(.x)))
# Removing extra spaces in all columns of VAS score and Extracting the important numbers we need as values for the column
ISP_block_data <- ISP_block_data %>% mutate(across(contains("VAS"), ~ as.numeric(parse_number(trimws(as.character(.x))))))
# Setting a condition with case_when function to unify the time values in time column
# Detection of wether word minute or hour are present and depending on that we extract the number
# number extracted would be either converted to minutes or already in minutes time
ISP_block_data <- ISP_block_data %>% mutate(time_of_peth_post_opt_min = case_when(
str_detect(time_of_peth_post_opt_min, "min") ~ parse_number(time_of_peth_post_opt_min),
str_detect(time_of_peth_post_opt_min, "h") ~ parse_number(time_of_peth_post_opt_min) * 60,
T ~ 0
))
# Converting values of columns to be numeric as needed
ISP_block_data <- ISP_block_data %>% mutate(across(c("first_dose_peth_post_opt_mg", "total_peth_post_opt_mg", "intra_opt_fentanyl_consump_mic"),
~as.numeric(.x)))
# Taking a look at the data after finishing of cleaning & conversions
str(ISP_block_data)
# Running the code for the cleaned data to analyze
source(file = "Data_Upload_Clean.R")
# Running the code for the cleaned data to analyze
source(file = "Data_Upload_Clean.R")
ISP_block_data <- ISP_block_data %>% mutate(time_of_peth_post_opt_min = ifelse(
time_of_peth_post_opt_min == 0, 480, time_of_peth_post_opt_min
))
survival_object <- Surv(time = ISP_block_data$time_of_peth_post_opt_min, ISP_block_data$`need of pethidine post operative`)
surv_fit <- survfit(survival_object ~ group, data = ISP_block_data)
ISP_block_data %>% surv_plot(dependent = "Surv(time_of_peth_post_opt_min, `need of pethidine post operative`)",
explanatory = "group", pval = T)
ISP_block_data <- ISP_block_data %>% mutate(time_of_peth_post_opt_min = ifelse(
time_of_peth_post_opt_min == 0, 480, time_of_peth_post_opt_min
))
survival_object <- Surv(time = ISP_block_data$time_of_peth_post_opt_min, ISP_block_data$`need of pethidine post operative`)
surv_fit <- survfit(survival_object ~ group, data = ISP_block_data)
ISP_block_data %>% surv_plot(dependent = "Surv(time_of_peth_post_opt_min, `need of pethidine post operative`)",
explanatory = "group", pval = T)
# Reading the data from the excel file with skippinng first row as it contains unneded organization
ISP_block_data <- read_excel(path = "Project-1-data copy.xlsx", skip = 1)
# Renaming columns to names shorter, representative and more easy to deal with
ISP_block_data <- ISP_block_data %>% rename(time_of_peth_post_opt_min = `time of pethidine post operative (min)`,
first_dose_peth_post_opt_mg = `first dose of pethidine post operative (mg)`,
total_peth_post_opt_mg = `total of pethidine post operative (mg)`,
intra_opt_fentanyl_consump_mic = `intra oprative fentanyl consumption (mic)`)
# Removing extra spaces in front and back of the column values
ISP_block_data$group <- ISP_block_data$group %>% str_trim()
# Removing text present with values of columns that should only include numeric data
ISP_block_data$first_dose_peth_post_opt_mg <- ISP_block_data$first_dose_peth_post_opt_mg %>% str_remove("mg") %>% str_trim()
ISP_block_data$total_peth_post_opt_mg <- ISP_block_data$total_peth_post_opt_mg %>% str_remove("mg") %>% str_trim()
ISP_block_data$intra_opt_fentanyl_consump_mic <- ISP_block_data$intra_opt_fentanyl_consump_mic %>% str_remove("mic") %>% str_trim()
# Coding columns to be factors and setting up codes as needed
ISP_block_data$sex <- factor(ISP_block_data$sex) %>% fct_recode("Female" = "0", "Male" = "1")
ISP_block_data$group <- factor(ISP_block_data$group) %>% fct_recode(
"Control group" = "control group", "ISSP Block group" = "ISSP block"
)
# Removing extra spaces in front and back of the column values
ISP_block_data$group <- ISP_block_data$group %>% str_trim()
ISP_block_data <- ISP_block_data %>% mutate(across("patient satisification", ~ fct_recode(as.factor(.x),
"satisfied" = "3",
"fair" = "2",
"dissatisfied" = "1")))
ISP_block_data$`surgeon satisification` <- ISP_block_data$`surgeon satisification` %>% factor() %>% fct_recode(
"very good" = "5",
"good" = "4",
"fair" = "3",
"not bad" = "2",
"dissatisfied" = "1"
)
ISP_block_data <- ISP_block_data %>% mutate(across(c("nausea", "vomiting", "pruritis", "others"), ~ factor(.x)))
# Removing extra spaces in all columns of VAS score and Extracting the important numbers we need as values for the column
ISP_block_data <- ISP_block_data %>% mutate(across(contains("VAS"), ~ as.numeric(parse_number(trimws(as.character(.x))))))
# Setting a condition with case_when function to unify the time values in time column
# Detection of wether word minute or hour are present and depending on that we extract the number
# number extracted would be either converted to minutes or already in minutes time
ISP_block_data <- ISP_block_data %>% mutate(time_of_peth_post_opt_min = case_when(
str_detect(time_of_peth_post_opt_min, "min") ~ parse_number(time_of_peth_post_opt_min),
str_detect(time_of_peth_post_opt_min, "h") ~ parse_number(time_of_peth_post_opt_min) * 60,
T ~ 0
))
# Converting values of columns to be numeric as needed
ISP_block_data <- ISP_block_data %>% mutate(across(c("first_dose_peth_post_opt_mg", "total_peth_post_opt_mg", "intra_opt_fentanyl_consump_mic"),
~as.numeric(.x)))
# Taking a look at the data after finishing of cleaning & conversions
str(ISP_block_data)
# Running the code for the cleaned data to analyze
source(file = "Data_Upload_Clean.R")
ISP_block_data <- ISP_block_data %>% mutate(time_of_peth_post_opt_min = ifelse(
time_of_peth_post_opt_min == 0, 480, time_of_peth_post_opt_min
))
survival_object <- Surv(time = ISP_block_data$time_of_peth_post_opt_min, ISP_block_data$`need of pethidine post operative`)
surv_fit <- survfit(survival_object ~ group, data = ISP_block_data)
ISP_block_data %>% surv_plot(dependent = "Surv(time_of_peth_post_opt_min, `need of pethidine post operative`)",
explanatory = "group", pval = T)
survival_object <- Surv(time = time_of_peth_post_opt_min, `need of pethidine post operative`, data = ISP_block_data)
survival_object <- Surv(time = ISP_block_data$time_of_peth_post_opt_min, ISP_block_data$`need of pethidine post operative`)
surv_fit <- survfit(survival_object ~ group, data = ISP_block_data)
summary(surv_fit)
ggsurvplot(surv_fit, data = ISP_block_data, conf.int = T, xlab = "Minutes",
ylab = "Survival Probability", pval = T, pval.coord = c(210, 0.12))
?ggsurvplot
ggsurvplot(surv_fit, data = ISP_block_data, conf.int = T, xlab = "Minutes",
ylab = "Survival Probability", pval = T, pval.coord = c(210, 0.12),
pallette = scale_fill_brewer(palette = "Blues"))
ggsurvplot(surv_fit, data = ISP_block_data, conf.int = T, xlab = "Minutes",
ylab = "Survival Probability", pval = T, pval.coord = c(210, 0.12))
ISP_block_data %>% surv_plot(dependent = "Surv(time_of_peth_post_opt_min, `need of pethidine post operative`)",
explanatory = "group", pval = T)
ggsurvplot(surv_fit, data = ISP_block_data, conf.int = T, xlab = "Minutes",
ylab = "Survival Probability", pval = T, pval.coord = c(210, 0.12))
# Making Kaplan Meier Curve
ggsurvplot(surv_fit, data = ISP_block_data, xlab = "Minutes",
ylab = "Survival Probability", pval = T, pval.coord = c(210, 0.12))
T
# Making Kaplan Meier Curve
ggsurvplot(surv_fit, data = ISP_block_data, conf.int = T, xlab = "Minutes",
ylab = "Survival Probability", pval = T, pval.coord = c(210, 0.12))
# Adjusting the format of the table, making long format for VAS scores so we could plot the data
long_format <- ISP_block_data %>% select(ID, contains("VAS"), -`Pre opr VAS score`, group) %>%
pivot_longer(cols = matches("VAS"), names_to = "Time", values_to = "VAS") %>%
mutate(Time = factor(Time, levels = c("30 min post opt VAS", "1 h post opt VAS", "2h post opt VAS", "4 h post opt VAS",
"6h post opt VAS", "8h post opt VAS", "12h post opt VAS", "18h post opt VAS",
"24h post opt VAS", "36h post opt VAS", "48h post opt VAS"),
labels = c("30 min", "1h", "2h", "4h", "6h", "8h", "12h", "18h", "24h", "36h", "48h")))
# Bar Plot Comparing medians of VAS score between the two groups in different time points
VAS_Summ <- long_format %>% group_by(group, Time) %>% summarise(Median = median(VAS), IQR = IQR(VAS))
# Adjusting the format of the table, making long format for VAS scores so we could plot the data
long_format <- ISP_block_data %>% select(ID, contains("VAS"), -`Pre opr VAS score`, group) %>%
pivot_longer(cols = matches("VAS"), names_to = "Time", values_to = "VAS") %>%
mutate(Time = factor(Time, levels = c("30 min post opt VAS", "1 h post opt VAS", "2h post opt VAS", "4 h post opt VAS",
"6h post opt VAS", "8h post opt VAS", "12h post opt VAS", "18h post opt VAS",
"24h post opt VAS", "36h post opt VAS", "48h post opt VAS"),
labels = c("30 min", "1h", "2h", "4h", "6h", "8h", "12h", "18h", "24h", "36h", "48h")))
# Bar Plot Comparing medians of VAS score between the two groups in different time points
VAS_Summ <- long_format %>% group_by(group, Time) %>% summarise(Median = median(VAS), IQR = IQR(VAS))
VAS_Visual <- VAS_Summ %>% ggplot(aes(Time, Median, fill = group)) + geom_col(position = position_dodge(width = 0.5)) +
scale_fill_manual(values = c("#023E8A", "#00B4D8")) + theme_minimal()
VAS_Visual
library(here)
# Reading the data from the excel file with skippinng first row as it contains unneded organization
ISP_block_data <- read_excel(path = here("Project-1-data copy.xlsx"), skip = 1)
source("~/Documents/Research/Research Projects/Minwal M.Elsherif Practical Course/Inter-semispinal plane (ISP) block for postoperative analgesia /Data_Upload_Clean.R", echo = TRUE)
# Running the code for the cleaned data to analyze
source(file = here("Data_Upload_Clean.R"))
library(readxl)
library(dplyr)
library(tidyverse)
library(lubridate)
library(finalfit)
library(gtsummary)
library(broom)
library(magrittr)
library(epiR)
library(survival)
library(survminer)
library(finalfit)
library(flextable)
library(here)
# Reading the data from the excel file with skippinng first row as it contains unneeded organization
ISP_block_data <- read_excel(path = here("Project-1-data copy.xlsx"), skip = 1)
# Renaming columns to names shorter, representative and more easy to deal with
ISP_block_data <- ISP_block_data %>% rename(time_of_peth_post_opt_min = `time of pethidine post operative (min)`,
first_dose_peth_post_opt_mg = `first dose of pethidine post operative (mg)`,
total_peth_post_opt_mg = `total of pethidine post operative (mg)`,
intra_opt_fentanyl_consump_mic = `intra oprative fentanyl consumption (mic)`)
# Removing extra spaces in front and back of the column values
ISP_block_data$group <- ISP_block_data$group %>% str_trim()
# Removing text present with values of columns that should only include numeric data
ISP_block_data$first_dose_peth_post_opt_mg <- ISP_block_data$first_dose_peth_post_opt_mg %>% str_remove("mg") %>% str_trim()
ISP_block_data$total_peth_post_opt_mg <- ISP_block_data$total_peth_post_opt_mg %>% str_remove("mg") %>% str_trim()
ISP_block_data$intra_opt_fentanyl_consump_mic <- ISP_block_data$intra_opt_fentanyl_consump_mic %>% str_remove("mic") %>% str_trim()
# Coding columns to be factors and setting up codes as needed
ISP_block_data$sex <- factor(ISP_block_data$sex) %>% fct_recode("Female" = "0", "Male" = "1")
ISP_block_data$group <- factor(ISP_block_data$group) %>% fct_recode(
"Control group" = "control group", "ISSP Block group" = "ISSP block"
)
# Removing extra spaces in front and back of the column values
ISP_block_data$group <- ISP_block_data$group %>% str_trim()
# Coding columns to be factors and setting up codes as needed
ISP_block_data <- ISP_block_data %>% mutate(across("patient satisification", ~ fct_recode(as.factor(.x),
"satisfied" = "3",
"fair" = "2",
"dissatisfied" = "1")))
ISP_block_data$`surgeon satisification` <- ISP_block_data$`surgeon satisification` %>% factor() %>% fct_recode(
"very good" = "5",
"good" = "4",
"fair" = "3",
"not bad" = "2",
"dissatisfied" = "1"
)
ISP_block_data <- ISP_block_data %>% mutate(across(c("nausea", "vomiting", "pruritis", "others"), ~ factor(.x)))
# Removing extra spaces in all columns of VAS score and Extracting the important numbers we need as values for the column
ISP_block_data <- ISP_block_data %>% mutate(across(contains("VAS"), ~ as.numeric(parse_number(trimws(as.character(.x))))))
# Setting a condition with case_when function to unify the time values in time column
# Detection of wether word minute or hour are present and depending on that we extract the number
# number extracted would be either converted to minutes or already in minutes time
ISP_block_data <- ISP_block_data %>% mutate(time_of_peth_post_opt_min = case_when(
str_detect(time_of_peth_post_opt_min, "min") ~ parse_number(time_of_peth_post_opt_min),
str_detect(time_of_peth_post_opt_min, "h") ~ parse_number(time_of_peth_post_opt_min) * 60,
T ~ 0
))
# Converting values of columns to be numeric as needed
ISP_block_data <- ISP_block_data %>% mutate(across(c("first_dose_peth_post_opt_mg", "total_peth_post_opt_mg", "intra_opt_fentanyl_consump_mic"),
~as.numeric(.x)))
# Making a summary table for hypothesize testing of different important values between intervention and control group
# Remove Zero Values from the columns as right now you're not testing the need of the medication,
# Instead you're testing doses on time difference upon those who needed the medication.
ISP_block_data %>% select(contains("peth"), group, intra_opt_fentanyl_consump_mic) %>%
filter(time_of_peth_post_opt_min != 0, first_dose_peth_post_opt_mg != 0,
total_peth_post_opt_mg != 0, intra_opt_fentanyl_consump_mic != 0) %>%
tbl_summary(by = group,
type = list(time_of_peth_post_opt_min ~ "continuous",
first_dose_peth_post_opt_mg ~ "continuous",
total_peth_post_opt_mg ~ "continuous",
intra_opt_fentanyl_consump_mic ~ "continuous"
),
label = list('need of pethidine post operative'	~ "Needed of Pethidine Post Operative",
time_of_peth_post_opt_min	~ "Time of Pethidine Post Operative (min)",
first_dose_peth_post_opt_mg ~ "First Dose of Pethidine Post Operative (mg)",
total_peth_post_opt_mg ~ "Total of Pethidine Consumed Post Operative (mg)",
intra_opt_fentanyl_consump_mic ~ "Intraoperative Fentanyl Consumption (microgram)")) %>%
add_p() %>% as_flex_table()
# Making a summary table for comparison of number of ADRs occurred between the two groups
# If the values are recorded as factors with levels of 0 and 1
# Convert them to event type as you're looking for just occurrences,
# This is done by specifiying the type and value needed in tbl_summary
ISP_block_data %>% select(nausea:pruritis, Any_ADR, group) %>%
tbl_summary(by = group, label = list(
nausea ~ "Nausea", vomiting ~ "Vomiting", pruritis ~ "Pruritis", Any_ADR ~ "Any ADRs"),
type = list( nausea ~ "dichotomous", vomiting ~ "dichotomous", pruritis ~ "dichotomous", Any_ADR ~ "dichotomous"),
value = list(nausea ~ 1, vomiting ~ 1, pruritis ~ 1, Any_ADR ~ "Yes")) %>%
add_p() %>% as_flex_table()
# Making a summary table for comparison of number of ADRs occurred between the two groups
# If the values are recorded as factors with levels of 0 and 1
# Convert them to event type as you're looking for just occurrences,
# This is done by specifiying the type and value needed in tbl_summary
ISP_block_data %>% select(nausea:pruritis, Any_ADR, group) %>%
tbl_summary(by = group, label = list(
nausea ~ "Nausea", vomiting ~ "Vomiting", pruritis ~ "Pruritis", Any_ADR ~ "Any ADRs"),
type = list( nausea ~ "dichotomous", vomiting ~ "dichotomous", pruritis ~ "dichotomous", Any_ADR ~ "dichotomous"),
value = list(nausea ~ 1, vomiting ~ 1, pruritis ~ 1, Any_ADR ~ "Yes")) %>%
add_p() %>% as_flex_table()
# As the frequency of specific ADRs is very low, We could create a column of wether there is any ADR or not
ISP_block_data <- ISP_block_data %>% mutate(Any_ADR = factor(as.integer(nausea == 1 | vomiting == 1 | pruritis == 1),
levels = c(0, 1),
labels = c("No", "Yes")))
# Making a summary table for comparison of number of ADRs occurred between the two groups
# If the values are recorded as factors with levels of 0 and 1
# Convert them to event type as you're looking for just occurrences,
# This is done by specifiying the type and value needed in tbl_summary
ISP_block_data %>% select(nausea:pruritis, Any_ADR, group) %>%
tbl_summary(by = group, label = list(
nausea ~ "Nausea", vomiting ~ "Vomiting", pruritis ~ "Pruritis", Any_ADR ~ "Any ADRs"),
type = list( nausea ~ "dichotomous", vomiting ~ "dichotomous", pruritis ~ "dichotomous", Any_ADR ~ "dichotomous"),
value = list(nausea ~ 1, vomiting ~ 1, pruritis ~ 1, Any_ADR ~ "Yes")) %>%
add_p() %>% as_flex_table()
# As the frequency of specific ADRs is very low, We could create a column of wether there is any ADR or not
ISP_block_data <- ISP_block_data %>% mutate(
Any_ADR = factor(as.integer(nausea == 1 | vomiting == 1 | pruritis == 1),
levels = c(0, 1),
labels = c("No", "Yes")))
# Making a summary table for comparison of number of ADRs occurred between the two groups
# If the values are recorded as factors with levels of 0 and 1
# Convert them to event type as you're looking for just occurrences,
# This is done by specifiying the type and value needed in tbl_summary
ISP_block_data %>% select(nausea:pruritis, Any_ADR, group) %>%
tbl_summary(by = group, label = list(
nausea ~ "Nausea", vomiting ~ "Vomiting", pruritis ~ "Pruritis", Any_ADR ~ "Any ADRs"),
type = list( nausea ~ "dichotomous", vomiting ~ "dichotomous", pruritis ~ "dichotomous",
Any_ADR ~ "dichotomous"),
value = list(nausea ~ 1, vomiting ~ 1, pruritis ~ 1, Any_ADR ~ "Yes")) %>%
add_p() %>% as_flex_table()
# Making a summary table for comparing VAS scores between the two groups in different time points
ISP_block_data %>% select(group, contains("VAS")) %>%
tbl_summary(by = group,
type = list(contains("VAS") ~ "continuous")) %>% add_p() %>%
add_q(method = "bonferroni") %>% as_flex_table()
